# ç¸®ç•¥åœ–åŠŸèƒ½å‡ç´šèªªæ˜

## ğŸ“‹ æ›´æ–°å…§å®¹

æ­¤æ¬¡æ›´æ–°åŠ å…¥äº†ç¸®ç•¥åœ–æ”¯æ´ï¼Œå¤§å¹…æå‡ç¶²é åŠ è¼‰é€Ÿåº¦ï¼ˆé è¨ˆç¯€çœ 95% åˆæ¬¡åŠ è¼‰æµé‡ï¼‰ã€‚

### å¾Œç«¯ä¿®æ”¹ (train_detect)

1. **ImgbbUploader.upload_image()** - æ–°å¢å›å‚³æ¬„ä½
   - åŸæœ¬åªå›å‚³ `url`ï¼ˆåŸåœ–ï¼‰
   - ç¾åœ¨åŒæ™‚å›å‚³ `thumb_url` å’Œ `medium_url`
   - imgbb è‡ªå‹•ç”Ÿæˆå¤šç¨®å°ºå¯¸ï¼Œç„¡éœ€é¡å¤–ä¸Šå‚³

2. **GoogleSheetsWriter.append_row()** - æ–°å¢åƒæ•¸
   - æ–°å¢ `thumbnail_url` åƒæ•¸ï¼ˆé è¨­ç‚ºç©ºå­—ä¸²ï¼‰
   - å¯«å…¥é †åºï¼šæ—¥æœŸã€æ™‚é–“ã€åŸåœ–urlã€**ç¸®åœ–url**ã€å‚™è¨»

3. **TrainEventUploader.upload_train_event()** - å‚³éç¸®ç•¥åœ–
   - å¾ imgbb å›æ‡‰ä¸­æå– `thumb_url`
   - è‡ªå‹•å¯«å…¥ Google Sheets

### å‰ç«¯ä¿®æ”¹ (train_detect_web)

1. **parseCSV()** - å…¼å®¹æ–°èˆŠæ ¼å¼
   - æ–°æ ¼å¼ï¼ˆ5æ¬„ï¼‰ï¼šæ—¥æœŸã€æ™‚é–“ã€åŸåœ–ã€ç¸®åœ–ã€å‚™è¨»
   - èˆŠæ ¼å¼ï¼ˆ4æ¬„ï¼‰ï¼šæ—¥æœŸã€æ™‚é–“ã€åŸåœ–ã€å‚™è¨»
   - è‡ªå‹•åˆ¤æ–·ä¸¦å›é€€åˆ°åŸåœ–ï¼ˆèˆŠè³‡æ–™ç›¸å®¹ï¼‰

2. **renderTable()** - å„ªå…ˆé¡¯ç¤ºç¸®ç•¥åœ–
   - è¡¨æ ¼ä¸­é¡¯ç¤º `thumbnail`ï¼ˆç´„ 150Ã—150pxï¼‰
   - åŸåœ– URL å„²å­˜åœ¨ `data-fullsize` å±¬æ€§
   - é»æ“Šå¾Œæ‰è¼‰å…¥åŸåœ–åˆ° Lightbox

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### 1. Google Sheets è¨­å®š

åœ¨æ‚¨çš„ Google Sheet ä¸­ï¼Œéœ€è¦**æ‰‹å‹•æ–°å¢ä¸€æ¬„**ï¼š

**ç›®å‰æ¬„ä½é †åºï¼ˆèˆŠï¼‰ï¼š**
```
A       B      C           D
æ—¥æœŸ    æ™‚é–“    imgur url   å‚™è¨»
```

**ä¿®æ”¹å¾Œæ¬„ä½é †åºï¼ˆæ–°ï¼‰ï¼š**
```
A       B      C           D          E
æ—¥æœŸ    æ™‚é–“    imgur url   ç¸®åœ–url     å‚™è¨»
```

**æ“ä½œæ­¥é©Ÿï¼š**
1. é–‹å•Ÿæ‚¨çš„ Google Sheet
2. åœ¨ç¬¬ D æ¬„ï¼ˆå‚™è¨»ï¼‰å‰æ’å…¥ä¸€æ¬„
3. å°‡æ¨™é¡Œæ”¹ç‚ºã€Œç¸®åœ–urlã€
4. èˆŠè³‡æ–™çš„ç¸®åœ–æ¬„ä½ç•™ç©ºå³å¯ï¼ˆå‰ç«¯æœƒè‡ªå‹•å›é€€ä½¿ç”¨åŸåœ–ï¼‰

### 2. é‡æ–°éƒ¨ç½²å¾Œç«¯

```bash
cd /home/mingming/01.Projects/train_detect

# å¦‚æœä½¿ç”¨ Docker
docker-compose down
docker-compose build
docker-compose up -d

# å¦‚æœç›´æ¥åŸ·è¡Œ Python
# å…ˆåœæ­¢èˆŠç¨‹åºï¼Œç„¶å¾Œï¼š
python train_detect/main.py
```

### 3. æ¸¬è©¦æ–°åŠŸèƒ½

ä¸Šå‚³ä¸€å¼µæ¸¬è©¦åœ–ç‰‡ï¼Œç¢ºèªï¼š

```bash
# æŸ¥çœ‹æ—¥èªŒç¢ºèªç¸®ç•¥åœ– URL æœ‰è¢«è¨˜éŒ„
tail -f logs/Log.txt

# æ‡‰è©²æœƒçœ‹åˆ°é¡ä¼¼ï¼š
# âœ“ Image uploaded successfully: https://i.ibb.co/xxx/image.jpg
# âœ“ Thumbnail URL: https://i.ibb.co/xxx/image.jpg
```

ç„¶å¾Œæª¢æŸ¥ Google Sheetsï¼š
- æœ€æ–°ä¸€ç­†è³‡æ–™çš„ç¬¬ 4 æ¬„ï¼ˆç¸®åœ–urlï¼‰æ‡‰è©²æœ‰å€¼
- URL æ ¼å¼é¡ä¼¼ `https://i.ibb.co/xxx/image.jpg`

### 4. å‰ç«¯æ›´æ–°

å‰ç«¯æ˜¯éœæ…‹ç¶²ç«™ï¼Œåªéœ€é‡æ–°æ•´ç†ç€è¦½å™¨å³å¯ï¼š

```bash
# å¦‚æœé€é GitHub Pages éƒ¨ç½²
cd /home/mingming/01.Projects/train_detect_web
git add app.js
git commit -m "feat: åŠ å…¥ç¸®ç•¥åœ–æ”¯æ´ä»¥å„ªåŒ–åŠ è¼‰é€Ÿåº¦"
git push

# ç­‰å¾… GitHub Pages è‡ªå‹•éƒ¨ç½²ï¼ˆç´„ 1-2 åˆ†é˜ï¼‰
```

æˆ–ç›´æ¥é–‹å•Ÿæœ¬åœ°æª”æ¡ˆæ¸¬è©¦ï¼š
```
file:///home/mingming/01.Projects/train_detect_web/index.html
```

## âœ… é©—è­‰æ¸…å–®

- [ ] Google Sheets å·²æ–°å¢ã€Œç¸®åœ–urlã€æ¬„ä½
- [ ] å¾Œç«¯å·²é‡æ–°éƒ¨ç½²
- [ ] ä¸Šå‚³æ¸¬è©¦åœ–ç‰‡æˆåŠŸï¼Œç¸®åœ– URL æœ‰å¯«å…¥ Google Sheets
- [ ] å‰ç«¯ç¶²é èƒ½æ­£å¸¸é¡¯ç¤ºç¸®ç•¥åœ–ï¼ˆåœ–ç‰‡è¼ƒå°ä½†è¼‰å…¥æ›´å¿«ï¼‰
- [ ] é»æ“Šç¸®ç•¥åœ–å¯é–‹å•ŸåŸåœ–çš„ Lightbox
- [ ] èˆŠè³‡æ–™ï¼ˆç„¡ç¸®åœ–æ¬„ä½ï¼‰ä»èƒ½æ­£å¸¸é¡¯ç¤º

## ğŸ“Š æ•ˆèƒ½æ”¹å–„

### æ”¹å–„å‰
- 50 ç­†è¨˜éŒ„ Ã— 400KBï¼ˆåŸåœ–ï¼‰= **~20MB** åˆæ¬¡è¼‰å…¥
- è¼‰å…¥æ™‚é–“ï¼š5-10 ç§’ï¼ˆ4G ç¶²è·¯ï¼‰

### æ”¹å–„å¾Œ
- 50 ç­†è¨˜éŒ„ Ã— 15KBï¼ˆç¸®åœ–ï¼‰= **~750KB** åˆæ¬¡è¼‰å…¥
- è¼‰å…¥æ™‚é–“ï¼š**<2 ç§’**ï¼ˆ4G ç¶²è·¯ï¼‰
- **ç¯€çœ 95% æµé‡** ğŸ‰

## ğŸ” æŠ€è¡“ç´°ç¯€

### imgbb åœ–ç‰‡å°ºå¯¸

imgbb API ä¸Šå‚³æˆåŠŸå¾Œå›å‚³çš„ JSON çµæ§‹ï¼š

```json
{
  "data": {
    "url": "https://i.ibb.co/xxx/image.jpg",           // åŸåœ–
    "thumb": {
      "url": "https://i.ibb.co/xxx/image.jpg"  // ç¸®åœ– (~150x150px)
    },
    "medium": {
      "url": "https://i.ibb.co/xxx/image.jpg"  // ä¸­å°ºå¯¸ (~500x375px)
    }
  }
}
```

ç›®å‰ä½¿ç”¨ `thumb` ä½œç‚ºè¡¨æ ¼é¡¯ç¤ºï¼Œè‹¥è¦ºå¾—å¤ªå°å¯æ”¹ç”¨ `medium`ã€‚

### ç›¸å®¹æ€§è¨­è¨ˆ

å‰ç«¯ä½¿ç”¨æ™ºèƒ½å›é€€æ©Ÿåˆ¶ï¼š

```javascript
// å¦‚æœç¸®åœ–å­˜åœ¨ä¸”èˆ‡åŸåœ–ä¸åŒï¼Œä½¿ç”¨ç¸®åœ–
const displayImg = (item.thumbnail && item.thumbnail !== item.image) 
                   ? item.thumbnail 
                   : item.image;
```

é€™ç¢ºä¿ï¼š
- æ–°è³‡æ–™ï¼šé¡¯ç¤ºç¸®åœ– âœ“
- èˆŠè³‡æ–™ï¼ˆç„¡ç¸®åœ–æ¬„ä½ï¼‰ï¼šé¡¯ç¤ºåŸåœ– âœ“
- ç¸®åœ–æ¬„ä½ç‚ºç©ºï¼šé¡¯ç¤ºåŸåœ– âœ“

## â“ å¸¸è¦‹å•é¡Œ

### Q1: èˆŠè³‡æ–™æœƒè¢«å½±éŸ¿å—ï¼Ÿ
**A:** ä¸æœƒã€‚èˆŠè³‡æ–™çš„ç¸®åœ–æ¬„ä½ç‚ºç©ºï¼Œå‰ç«¯æœƒè‡ªå‹•ä½¿ç”¨åŸåœ–ã€‚

### Q2: éœ€è¦é‡æ–°ä¸Šå‚³èˆŠåœ–ç‰‡å—ï¼Ÿ
**A:** ä¸éœ€è¦ã€‚èˆŠåœ–ç‰‡æ²’æœ‰ç¸®åœ–ä»èƒ½æ­£å¸¸é¡¯ç¤ºï¼Œåªæ˜¯è¼‰å…¥é€Ÿåº¦ä¸è®Šã€‚

### Q3: å¦‚æœ imgbb ä¸æä¾›ç¸®åœ–æ€éº¼è¾¦ï¼Ÿ
**A:** imgbb åœ¨åœ–ç‰‡ä¸Šå‚³æˆåŠŸå¾Œæœƒè‡ªå‹•ç”Ÿæˆå¤šç¨®å°ºå¯¸ï¼Œé€™æ˜¯å…¶å…§å»ºåŠŸèƒ½ã€‚è‹¥æœªä¾†æ”¹ç”¨å…¶ä»–åœ–åºŠï¼Œå¯èƒ½éœ€è¦èª¿æ•´ç¨‹å¼ç¢¼ã€‚

### Q4: å¯ä»¥èª¿æ•´ç¸®åœ–å¤§å°å—ï¼Ÿ
**A:** å¯ä»¥ã€‚ä¿®æ”¹ [uploader.py](train_detect/uploader.py#L80) ä¸­å›å‚³çš„ URLï¼š
- `thumb_url` â†’ ç´„ 150Ã—150px
- `medium_url` â†’ ç´„ 500Ã—375px

å°‡ `thumb_url` æ”¹ç‚º `medium_url` å³å¯ä½¿ç”¨æ›´å¤§çš„ç¸®åœ–ã€‚

### Q5: Lightbox é‚„æ˜¯é¡¯ç¤ºåŸåœ–å—ï¼Ÿ
**A:** æ˜¯çš„ã€‚é»æ“Šç¸®ç•¥åœ–å¾Œï¼ŒLightbox æœƒè¼‰å…¥å®Œæ•´åŸåœ–ï¼Œæä¾›æ¸…æ™°çš„æª¢è¦–é«”é©—ã€‚

## ğŸ“ å›æ»¾æ–¹æ¡ˆ

å¦‚æœéœ€è¦å›æ»¾åˆ°èˆŠç‰ˆæœ¬ï¼š

1. **å¾Œç«¯**ï¼šGit å›é€€åˆ°å‰ä¸€å€‹ commit
   ```bash
   cd /home/mingming/01.Projects/train_detect
   git log  # æ‰¾åˆ°å›é€€çš„ commit hash
   git checkout <commit-hash> train_detect/uploader.py
   ```

2. **å‰ç«¯**ï¼šåŒæ¨£å›é€€ app.js
   ```bash
   cd /home/mingming/01.Projects/train_detect_web
   git checkout <commit-hash> app.js
   ```

3. **Google Sheets**ï¼šå¯ä¿ç•™ã€Œç¸®åœ–urlã€æ¬„ä½ï¼ˆä¸å½±éŸ¿èˆŠç‰ˆç¨‹å¼ï¼‰

---

**æ›´æ–°æ—¥æœŸ**: 2026-01-24  
**ç‰ˆæœ¬**: v1.0  
**ç¶­è­·**: GitHub Copilot
